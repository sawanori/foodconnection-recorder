# å®Ÿè£…è¨ˆç”»æ›¸: ç”»åƒãƒ™ãƒ¼ã‚¹ç”Ÿæˆæ©Ÿèƒ½ã®å¾©æ´»ï¼ˆå˜ä¸€ç”»åƒç‰ˆï¼‰

**ä½œæˆæ—¥**: 2026-01-27
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0ï¼ˆæ”¹å–„ç‰ˆï¼‰
**ç›®çš„**: å‰Šé™¤ã•ã‚ŒãŸç”»åƒãƒ™ãƒ¼ã‚¹ç”Ÿæˆæ©Ÿèƒ½ã‚’ã€æ”¹å–„ã‚’åŠ ãˆã¦å¾©æ´»ã•ã›ã‚‹

---

## ğŸ“‹ 1. èƒŒæ™¯ã¨çµŒç·¯

### 1.1 ä»¥å‰ã®å®Ÿè£…ï¼ˆå‰Šé™¤æ¸ˆã¿ï¼‰

**ã‚³ãƒŸãƒƒãƒˆ `2add71d`** ã¾ã§ã«ä»¥ä¸‹ã®æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã—ãŸï¼š

```
backend/app/services/replicator/
â”œâ”€â”€ base_image_generator.py      # åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆåœ§ç¸®ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼‰
â”œâ”€â”€ claude_image_generator.py    # Claude Vision API
â”œâ”€â”€ gemini_image_generator.py    # Gemini API
â”œâ”€â”€ multi_section_generator.py   # ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†å‰²ç”Ÿæˆ
â”œâ”€â”€ design_extractor.py          # ãƒ‡ã‚¶ã‚¤ãƒ³æŠ½å‡º
â””â”€â”€ image_generator.py           # ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³
```

**æ©Ÿèƒ½:**
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’è¤‡æ•°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆ†å‰²
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã« HTML/CSS/JS ã‚’ç”Ÿæˆ
- æœ€å¾Œã«çµæœã‚’çµ±åˆ

### 1.2 å‰Šé™¤ã®ç†ç”±

**å•é¡Œ**: ç”»åƒã‚µã‚¤ã‚ºãŒ Claude API ã®5MBåˆ¶é™ã‚’è¶…é
```
å®Ÿéš›ã®é€ä¿¡ã‚µã‚¤ã‚º: 5.5MB (5,540,112 bytes)
Claude API åˆ¶é™: 5MB (5,242,880 bytes)
è¶…éé‡: 5.7%
```

**å¯¾å¿œ**: æ©Ÿèƒ½ã‚’å‰Šé™¤ã—ã€URL ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã«æˆ»ã—ãŸ

### 1.3 ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã®å•é¡Œç‚¹

**ç¾åœ¨ã® `ReplicatorRunner` ã®å‹•ä½œ:**
```python
scraped_data = await site_scraper.scrape(url)  # URLã‹ã‚‰å–å¾—
generated_code = await claude_generator.generate(scraped_data)  # Claude CLI
verification = await verifier.verify(...)  # æ¤œè¨¼ãƒ«ãƒ¼ãƒ—
```

**å•é¡Œ:**
1. **URLãŒå¿…è¦**: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã ã‘ã§ã¯ç”Ÿæˆã§ããªã„
2. **ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®åˆ¶é™**: å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å–å¾—ãŒé›£ã—ã„
3. **ç²¾åº¦ã®å•é¡Œ**: å®Ÿéš›ã®è¦‹ãŸç›®ã¨ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

### 1.4 ä»Šå›ã®ç›®æ¨™

**ã€Œç”»åƒã®ã¿ã‹ã‚‰ç›´æ¥Webã‚µã‚¤ãƒˆã‚’ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½ã€ã‚’å¾©æ´»ã•ã›ã‚‹**

ãŸã ã—ã€ä»¥ä¸‹ã®æ”¹å–„ã‚’åŠ ãˆã‚‹ï¼š
1. âœ… **ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†å‰²ã‚’å»ƒæ­¢** â†’ å˜ä¸€ç”»åƒã§é€ä¿¡
2. âœ… **åœ§ç¸®ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„** â†’ 5MBä»¥å†…ã«ç¢ºå®Ÿã«åã‚ã‚‹
3. âœ… **Base64ã‚µã‚¤ã‚ºæ¤œè¨¼** â†’ é€ä¿¡å‰ã«ç¢ºèª
4. âœ… **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Œå…¨æ€§** â†’ å…¨ä½“ã‚’1æšã§è¦‹ã‚‹ãŸã‚æ¬ è½ãªã—

---

## ğŸ¯ 2. æŠ€è¡“çš„æ ¹æ‹ 

### 2.1 ç”»åƒã‚µã‚¤ã‚ºã®æ¤œè¨¼çµæœ

**ãƒ†ã‚¹ãƒˆç”»åƒ**: 973x5000pxï¼ˆãƒ•ãƒ«ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼‰

| å½¢å¼ | å“è³ª | ãƒã‚¤ãƒŠãƒªã‚µã‚¤ã‚º | Base64ã‚µã‚¤ã‚º | 5MBåˆ¶é™å†… |
|-----|------|-------------|------------|----------|
| PNG | - | 4.9MB | 6.5MB | âŒ è¶…é |
| JPEG | Quality 90 | 0.62MB | 0.83MB | âœ… OK |
| JPEG | Quality 85 | 0.57MB | **0.76MB** | âœ… OK |
| JPEG | Quality 75 | 0.44MB | 0.58MB | âœ… OK |

**çµè«–**: Quality 85 ã§ **0.76MB**ï¼ˆ5MBåˆ¶é™ã®**15%ã®ã¿**ï¼‰
â†’ **ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†å‰²ã¯å®Œå…¨ã«ä¸è¦**

### 2.2 æ”¹å–„ã•ã‚ŒãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

#### Beforeï¼ˆå‰Šé™¤ã•ã‚ŒãŸå®Ÿè£…ï¼‰
```
ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼ˆ973x5000pxï¼‰
  â†“
ãƒ•ãƒ«ãƒšãƒ¼ã‚¸åˆ¤å®šï¼ˆheight > width * 2.5ï¼‰
  â†“ YES
ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†å‰²ï¼ˆ3ã€œ8ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
  â†“
å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆå„2MBï¼‰
  â†“ åˆè¨ˆ6MB â†’ 5MBè¶…é âŒ
ã‚¨ãƒ©ãƒ¼
```

#### Afterï¼ˆä»Šå›ã®å®Ÿè£…ï¼‰
```
ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼ˆ973x5000pxï¼‰
  â†“
JPEGåœ§ç¸®ï¼ˆQuality 85ï¼‰
  â†“
Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆ0.76MBï¼‰âœ…
  â†“
Claude Vision APIï¼ˆå˜ä¸€ç”»åƒï¼‰
  â†“
å®Œå…¨ãªHTML/CSS/JSç”Ÿæˆ
```

---

## ğŸ“ 3. å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### 3.1 æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | è¡Œæ•° | ç›®çš„ |
|---------|------|------|
| `base_image_generator.py` | ç´„550è¡Œ | åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆç”»åƒå‡¦ç†ã€åœ§ç¸®ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ |
| `claude_image_generator.py` | ç´„350è¡Œ | Claude Vision API å®Ÿè£… |
| `gemini_image_generator.py` | ç´„450è¡Œ | Gemini Vision API å®Ÿè£…ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| `image_generator.py` | ç´„50è¡Œ | ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ |
| `design_extractor.py` | ç´„150è¡Œ | ãƒ‡ã‚¶ã‚¤ãƒ³è¦ç´ æŠ½å‡ºï¼ˆè‰²ã€ãƒ•ã‚©ãƒ³ãƒˆï¼‰ |

**åˆè¨ˆ**: ç´„1550è¡Œ

### 3.2 ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ä¿®æ­£å†…å®¹ |
|---------|---------|
| `replicator_runner.py` | ç”»åƒãƒ™ãƒ¼ã‚¹ç”Ÿæˆãƒ•ãƒ­ãƒ¼ã®è¿½åŠ  |
| `config.py` | IMAGE_GENERATOR è¨­å®šã®è¿½åŠ  |
| `models.py` | screenshot_path ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| `requirements.txt` | anthropic SDK ã®è¿½åŠ  |

---

## ğŸ—ï¸ 4. å®Ÿè£…ã®è©³ç´°

### 4.1 base_image_generator.pyï¼ˆåŸºåº•ã‚¯ãƒ©ã‚¹ï¼‰

**è²¬ä»»ç¯„å›²:**
- ç”»åƒã®å‰å‡¦ç†ï¼ˆRGBA â†’ RGBå¤‰æ›ï¼‰
- JPEGåœ§ç¸®ï¼ˆæ®µéšçš„å“è³ªèª¿æ•´ï¼‰
- Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ã‚µã‚¤ã‚ºæ¤œè¨¼
- å…±é€šãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®šç¾©

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**

#### 4.1.1 ç”»åƒã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
```python
def _encode_image_to_base64(
    self,
    img: Image.Image,
    max_base64_size_bytes: int = 3_600_000  # 3.6MBï¼ˆ70%ãƒãƒ¼ã‚¸ãƒ³ï¼‰
) -> tuple[str, str]:
    """
    ç”»åƒã‚’Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆ5MBåˆ¶é™ã‚’ç¢ºå®Ÿã«éµå®ˆï¼‰

    å‡¦ç†ãƒ•ãƒ­ãƒ¼:
    1. RGBA â†’ RGB å¤‰æ›
    2. PNGæœ€é©åŒ–ã‚’è©¦ã™
    3. JPEG quality=90 ã‚’è©¦ã™
    4. ãƒ€ãƒ¡ãªã‚‰æ®µéšçš„åœ§ç¸®ï¼ˆ85â†’80â†’75â†’...â†’50ï¼‰
    5. ã¾ã ãƒ€ãƒ¡ãªã‚‰ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆ1.0â†’0.95â†’...â†’0.3ï¼‰
    6. æœ€çµ‚æ‰‹æ®µ: scale=0.25, quality=60

    Returns:
        (base64_data, media_type)
    """
```

**å®Ÿè£…ã®å·¥å¤«:**
- âœ… **å®Ÿéš›ã®Base64ã‚µã‚¤ã‚ºã‚’è¨ˆç®—** â†’ é€ä¿¡å‰ã«ç¢ºå®Ÿã«ç¢ºèª
- âœ… **æ®µéšçš„åœ§ç¸®** â†’ ç”»è³ªã¨ã‚µã‚¤ã‚ºã®ãƒãƒ©ãƒ³ã‚¹
- âœ… **è©³ç´°ãƒ­ã‚°** â†’ ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„

#### 4.1.2 åœ§ç¸®ãƒ­ã‚¸ãƒƒã‚¯
```python
def _compress_and_encode_with_validation(
    self,
    img: Image.Image,
    max_base64_size_bytes: int
) -> str:
    """
    æ®µéšçš„åœ§ç¸®ã¨Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰

    åœ§ç¸®æˆ¦ç•¥:
    - Quality: 85 â†’ 80 â†’ 75 â†’ 70 â†’ 65 â†’ 60 â†’ 55 â†’ 50
    - Scale: 1.0 â†’ 0.95 â†’ 0.9 â†’ 0.85 â†’ ... â†’ 0.3
    - æœ€å¤§20å›ã®è©¦è¡Œ

    Returns:
        base64_dataï¼ˆ5MBä»¥å†…ä¿è¨¼ï¼‰
    """
```

**ãƒ†ã‚¹ãƒˆçµæœ:**
```
973x5000px ç”»åƒ:
- Attempt 1: Quality=85 â†’ 0.76MB âœ… æˆåŠŸï¼
```

### 4.2 claude_image_generator.pyï¼ˆClaude Vision APIï¼‰

**è²¬ä»»ç¯„å›²:**
- Claude Vision API (Anthropic SDK) ã®å‘¼ã³å‡ºã—
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ãƒ¼ã‚¹ï¼ˆJSONæŠ½å‡ºï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**

#### 4.2.1 å˜ä¸€ç”»åƒã‹ã‚‰ã®ç”Ÿæˆ
```python
async def generate_from_image(
    self,
    image_path: str,
    html_content: Optional[str] = None,
    video_path: Optional[str] = None,
    viewport_width: int = 1366,
    viewport_height: int = 768,
    design_tokens: Optional[Dict] = None
) -> Dict[str, str]:
    """
    ç”»åƒã‹ã‚‰ç›´æ¥ HTML/CSS/JS ã‚’ç”Ÿæˆ

    Args:
        image_path: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç”»åƒãƒ‘ã‚¹
        html_content: å…ƒHTMLã‚½ãƒ¼ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€å‚è€ƒæƒ…å ±ï¼‰
        video_path: éŒ²ç”»å‹•ç”»ãƒ‘ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        viewport_width: ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå¹…
        viewport_height: ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆé«˜ã•
        design_tokens: ãƒ‡ã‚¶ã‚¤ãƒ³è¦ç´ ï¼ˆè‰²ã€ãƒ•ã‚©ãƒ³ãƒˆï¼‰

    Returns:
        {"html": "...", "css": "...", "js": "..."}
    """
```

**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹æˆ:**
```python
GENERATION_PROMPT = """
æ·»ä»˜ç”»åƒã¯Webãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ã™ã€‚
ã“ã®ç”»åƒã‚’è¦‹ã¦ã€å®Œå…¨ã«åŒã˜ãƒ‡ã‚¶ã‚¤ãƒ³ã®Webã‚µã‚¤ãƒˆã‚’å†ç¾ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

## å®Ÿè£…è¦ä»¶
1. **å®Œå…¨ãªHTMLæ§‹é€ **: <!DOCTYPE html>ã‹ã‚‰</html>ã¾ã§
2. **ãƒ‡ã‚¶ã‚¤ãƒ³å†ç¾**:
   - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: {viewport_width}x{viewport_height}px
   - è‰²: {design_colors}
   - ãƒ•ã‚©ãƒ³ãƒˆ: {design_fonts}
3. **ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³é«˜ã•ãƒ«ãƒ¼ãƒ«**:
   ```css
   .hero {
     height: 80vh;  /* PC */
   }
   @media (max-width: 1023px) {
     .hero { height: 100vh; }  /* ãƒ¢ãƒã‚¤ãƒ« */
   }
   ```
4. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–**: ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼ˆmax-width: 768pxï¼‰
5. **ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒ**: https://picsum.photos/å¹…/é«˜ã•

## å‡ºåŠ›å½¢å¼ï¼ˆJSONã®ã¿ï¼‰
{
  "html": "<!DOCTYPE html>...",
  "css": "/* å…¨ã¦ã®CSS */",
  "js": "// å¿…è¦ãªJS"
}
"""
```

#### 4.2.2 APIå‘¼ã³å‡ºã—
```python
async def _call_api_with_image(
    self,
    image_data: str,
    media_type: str,
    prompt: str,
    use_system_prompt: bool = True
) -> Dict[str, str]:
    """
    Claude Vision API å‘¼ã³å‡ºã—

    ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«: claude-sonnet-4-5-20250929
    ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 900ç§’ï¼ˆ15åˆ†ï¼‰
    max_tokens: 8000
    """
    response = self.client.messages.create(
        model="claude-sonnet-4-5-20250929",
        max_tokens=8000,
        timeout=900.0,
        system=[{"type": "text", "text": SYSTEM_PROMPT}] if use_system_prompt else [],
        messages=[
            {
                "role": "user",
                "content": [
                    {
                        "type": "image",
                        "source": {
                            "type": "base64",
                            "media_type": media_type,
                            "data": image_data
                        }
                    },
                    {"type": "text", "text": prompt}
                ]
            }
        ]
    )

    result_text = response.content[0].text
    return self._parse_response(result_text)
```

#### 4.2.3 å‹•ç”»å¯¾å¿œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```python
def _encode_video_to_base64(self, video_path: str) -> tuple[Optional[str], str]:
    """
    å‹•ç”»ã‚’Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰

    ã‚µã‚¤ã‚ºåˆ¶é™: 25MB
    å¯¾å¿œå½¢å¼: .webm, .mp4, .mov, .avi
    """
```

### 4.3 design_extractor.pyï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³æŠ½å‡ºï¼‰

**è²¬ä»»ç¯„å›²:**
- HTMLã‹ã‚‰è‰²ã¨ãƒ•ã‚©ãƒ³ãƒˆã‚’æŠ½å‡º
- ç”»åƒã‹ã‚‰ä¸»è¦ãªè‰²ã‚’æŠ½å‡ºï¼ˆPIL + KMeansï¼‰
- ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆ

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**

```python
class DesignExtractor:
    def extract_from_html(self, html_content: str) -> Dict:
        """
        HTMLã‹ã‚‰è‰²ã¨ãƒ•ã‚©ãƒ³ãƒˆã‚’æŠ½å‡º

        Returns:
            {
                "colors": ["#FFFFFF", "#000000", ...],
                "fonts": ["Arial", "Helvetica", ...]
            }
        """

    def extract_from_image(self, image_path: str, num_colors: int = 10) -> List[str]:
        """
        ç”»åƒã‹ã‚‰ä¸»è¦ãªè‰²ã‚’æŠ½å‡ºï¼ˆK-meansæ³•ï¼‰

        Returns:
            ["#FFFFFF", "#FF0000", ...]
        """
```

### 4.4 image_generator.pyï¼ˆãƒ•ã‚¡ã‚¯ãƒˆãƒªï¼‰

```python
class ImageGeneratorFactory:
    @staticmethod
    def create(provider: str = "claude") -> BaseImageGenerator:
        """
        æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆ

        Args:
            provider: "claude" or "gemini"

        Returns:
            BaseImageGenerator ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        """
        if provider == "claude":
            return ClaudeImageGenerator()
        elif provider == "gemini":
            return GeminiImageGenerator()
        else:
            raise ValueError(f"Unknown provider: {provider}")
```

### 4.5 replicator_runner.py ã®ä¿®æ­£

**ä¿®æ­£ç®‡æ‰€: `_execute` ãƒ¡ã‚½ãƒƒãƒ‰**

#### Beforeï¼ˆç¾åœ¨ï¼‰
```python
async def _execute(self, job_id: str):
    # Phase 1: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
    scraped_data = await self._scrape(job_id)

    # Phase 2: åˆå›ç”Ÿæˆ
    generated_code = await self._generate(job_id, scraped_data)

    # Phase 3: æ¤œè¨¼ãƒ«ãƒ¼ãƒ—
    ...
```

#### Afterï¼ˆä¿®æ­£å¾Œï¼‰
```python
async def _execute(self, job_id: str):
    # å…¥åŠ›ãƒ‡ãƒ¼ã‚¿å–å¾—
    job = await self._get_job(job_id)

    # ç”Ÿæˆãƒ¢ãƒ¼ãƒ‰ã®åˆ¤å®š
    if job.screenshot_path and os.path.exists(job.screenshot_path):
        # ãƒ¢ãƒ¼ãƒ‰A: ç”»åƒãƒ™ãƒ¼ã‚¹ç”Ÿæˆ
        logger.info(f"Using image-based generation: {job.screenshot_path}")
        generated_code = await self._generate_from_image(job_id, job.screenshot_path)
    elif job.source_url:
        # ãƒ¢ãƒ¼ãƒ‰B: URLãƒ™ãƒ¼ã‚¹ç”Ÿæˆï¼ˆæ—¢å­˜ï¼‰
        logger.info(f"Using URL-based generation: {job.source_url}")
        scraped_data = await self._scrape(job_id)
        generated_code = await self._generate(job_id, scraped_data)
    else:
        raise ValueError("No input source (screenshot or URL)")

    # ä¿å­˜
    output_dir = await self._save_files(job_id, generated_code)

    # Phase 3: æ¤œè¨¼ãƒ«ãƒ¼ãƒ—ï¼ˆæ—¢å­˜ã®ã¾ã¾ï¼‰
    ...
```

**æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰:**
```python
async def _generate_from_image(
    self,
    job_id: str,
    image_path: str
) -> dict:
    """
    ç”»åƒã‹ã‚‰ç›´æ¥ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ

    Args:
        job_id: ã‚¸ãƒ§ãƒ–ID
        image_path: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç”»åƒãƒ‘ã‚¹

    Returns:
        {"html": "...", "css": "...", "js": "..."}
    """
    logger.info(f"Generating from image: {image_path}")

    # ç”»åƒã‚µã‚¤ã‚ºã‚’ãƒ­ã‚°å‡ºåŠ›
    from PIL import Image
    img = Image.open(image_path)
    width, height = img.size
    img.close()
    logger.info(f"Image size: {width}x{height} (aspect ratio: {height/width:.2f})")

    # ãƒ‡ã‚¶ã‚¤ãƒ³æŠ½å‡º
    design_tokens = None
    if hasattr(self, 'design_extractor'):
        design_tokens = await self.design_extractor.extract_from_image(image_path)

    # ç”»åƒã‹ã‚‰ç”Ÿæˆ
    generated_code = await self.image_generator.generate_from_image(
        image_path=image_path,
        design_tokens=design_tokens
    )

    return generated_code
```

---

## ğŸ§ª 5. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 5.1 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

#### TC-1: å°ã•ã„ç”»åƒï¼ˆå¾“æ¥é€šã‚Šï¼‰
```
å…¥åŠ›: 973x1500px ã®ç”»åƒ
æœŸå¾…çµæœ:
  - åœ§ç¸®ãªã—ã¾ãŸã¯è»½å¾®ãªåœ§ç¸®
  - Base64ã‚µã‚¤ã‚º < 5MB
  - HTML/CSS/JSç”ŸæˆæˆåŠŸ
```

#### TC-2: å¤§ãã„ç”»åƒï¼ˆãƒ•ãƒ«ãƒšãƒ¼ã‚¸ï¼‰
```
å…¥åŠ›: 973x5000px ã®ç”»åƒï¼ˆCITIZEN KIZASHIï¼‰
æœŸå¾…çµæœ:
  - JPEG Quality 85 ã§åœ§ç¸® â†’ 0.76MB
  - Base64ã‚µã‚¤ã‚º: 0.76MBï¼ˆ5MBã®15%ï¼‰
  - å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå«ã¾ã‚Œã‚‹:
    âœ“ ãƒ’ãƒ¼ãƒ­ãƒ¼
    âœ“ èª¬æ˜æ–‡
    âœ“ å•†å“ç”»åƒ4æš
    âœ“ ãƒ•ãƒƒã‚¿ãƒ¼
  - HTMLè¡Œæ•°: 350è¡Œä»¥ä¸Š
```

#### TC-3: éå¸¸ã«å¤§ãã„ç”»åƒï¼ˆã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆï¼‰
```
å…¥åŠ›: 1920x10000px ã®ç”»åƒ
æœŸå¾…çµæœ:
  - æ®µéšçš„åœ§ç¸®ãŒå‹•ä½œ
  - æœ€çµ‚çš„ã«5MBä»¥å†…ã«åã¾ã‚‹
  - ã‚¨ãƒ©ãƒ¼ãªã—
```

#### TC-4: å‹•ç”»å…¥åŠ›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```
å…¥åŠ›: ç”»åƒ + å‹•ç”»ï¼ˆ.webmï¼‰
æœŸå¾…çµæœ:
  - å‹•ç”»ã‹ã‚‰JavaScriptã‚’ç”Ÿæˆ
  - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³/ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãŒå«ã¾ã‚Œã‚‹
```

#### TC-5: URLãƒ™ãƒ¼ã‚¹ç”Ÿæˆï¼ˆæ—¢å­˜æ©Ÿèƒ½ï¼‰
```
å…¥åŠ›: URLï¼ˆscreenshot_pathãŒnullï¼‰
æœŸå¾…çµæœ:
  - æ—¢å­˜ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼ãŒå‹•ä½œ
  - å¾Œæ–¹äº’æ›æ€§ãŒä¿ãŸã‚Œã‚‹
```

### 5.2 æ¤œè¨¼é …ç›®

| é …ç›® | æ¤œè¨¼æ–¹æ³• | åˆ¤å®šåŸºæº– |
|-----|---------|---------|
| **ç”»åƒã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯** | ãƒ­ã‚°ã§Base64ã‚µã‚¤ã‚ºç¢ºèª | 5MBä»¥å†… |
| **åœ§ç¸®å“è³ª** | ç”Ÿæˆã•ã‚ŒãŸHTMLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª | ç”»è³ªåŠ£åŒ–ãŒãªã„ |
| **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Œå…¨æ€§** | HTMLã®è¡Œæ•°ã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ•° | 350è¡Œä»¥ä¸Šã€å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³å«ã‚€ |
| **ãƒ’ãƒ¼ãƒ­ãƒ¼é«˜ã•ãƒ«ãƒ¼ãƒ«** | DevToolsã§CSSã‚’ç¢ºèª | PC: 80vh, Mobile: 100vh |
| **ç”Ÿæˆæ™‚é–“** | ãƒ­ã‚°ã§ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç¢ºèª | 3åˆ†ä»¥å†… |
| **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** | ç„¡åŠ¹ãªç”»åƒã€å·¨å¤§ç”»åƒã§ãƒ†ã‚¹ãƒˆ | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é©åˆ‡ |
| **å¾Œæ–¹äº’æ›æ€§** | URLå…¥åŠ›ã§ãƒ†ã‚¹ãƒˆ | æ—¢å­˜ãƒ•ãƒ­ãƒ¼ãŒå‹•ä½œ |

### 5.3 ãƒ†ã‚¹ãƒˆæ‰‹é †

```bash
# 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd backend
pip install anthropic pillow scikit-learn

# 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
export ANTHROPIC_API_KEY="sk-ant-..."
export IMAGE_GENERATOR="claude"  # ã¾ãŸã¯ "gemini"

# 3. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd ..
./start.sh

# 4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œ
# TC-2: ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ç”»åƒ
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰:
#   - INPUT: /Volumes/DB/ä¿å­˜
#   - OUTPUT: /Volumes/DB/test_image_based_v2
#   - screenshot_path: /Volumes/DB/ä¿å­˜/FireShot*.png

# 5. çµæœç¢ºèª
open /Volumes/DB/test_image_based_v2/index.html

# 6. ãƒ­ã‚°ç¢ºèª
tail -100 backend/app/logs/app.log | grep -E "(Image size|Base64|Compressed)"

# 7. HTMLè¡Œæ•°ç¢ºèª
wc -l /Volumes/DB/test_image_based_v2/index.html
# æœŸå¾…: 350è¡Œä»¥ä¸Š
```

---

## âš ï¸ 6. ãƒªã‚¹ã‚¯è©•ä¾¡

### 6.1 ãƒªã‚¹ã‚¯ä¸€è¦§

| ãƒªã‚¹ã‚¯ | ç™ºç”Ÿç¢ºç‡ | å½±éŸ¿åº¦ | å¯¾ç­– |
|--------|---------|--------|------|
| **è¶…å·¨å¤§ç”»åƒã§5MBè¶…é** | ä½ | ä¸­ | æ®µéšçš„åœ§ç¸®ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã§å¯¾å¿œ |
| **APIå‘¼ã³å‡ºã—å¤±æ•—** | ä¸­ | é«˜ | ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã€è©³ç´°ã‚¨ãƒ©ãƒ¼ãƒ­ã‚° |
| **ç”Ÿæˆå“è³ªã®ä½ä¸‹** | ä¸­ | ä¸­ | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ”¹å–„ã€ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³æ´»ç”¨ |
| **ç”Ÿæˆæ™‚é–“ã®å¢—åŠ ** | ä½ | ä½ | éåŒæœŸå‡¦ç†ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ15åˆ†ï¼‰ |
| **å¾Œæ–¹äº’æ›æ€§ã®ç ´å£Š** | ä½ | é«˜ | æ—¢å­˜ã®URLãƒ™ãƒ¼ã‚¹ç”Ÿæˆã‚’æ®‹ã™ |
| **ä¾å­˜é–¢ä¿‚ã®ç«¶åˆ** | ä½ | ä¸­ | requirements.txtã§æ˜ç¤ºçš„ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š |

### 6.2 ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

```bash
# 1. æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
rm backend/app/services/replicator/base_image_generator.py
rm backend/app/services/replicator/claude_image_generator.py
rm backend/app/services/replicator/gemini_image_generator.py
rm backend/app/services/replicator/image_generator.py
rm backend/app/services/replicator/design_extractor.py

# 2. replicator_runner.pyã‚’å…ƒã«æˆ»ã™
git checkout backend/app/services/replicator_runner.py

# 3. config.pyã‚’å…ƒã«æˆ»ã™
git checkout backend/app/config.py

# 4. ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
./start.sh
```

---

## ğŸ“Š 7. æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 7.1 å®šé‡çš„åŠ¹æœ

| é …ç›® | Beforeï¼ˆURLï¼‰ | Afterï¼ˆç”»åƒï¼‰ | æ”¹å–„ |
|-----|--------------|--------------|------|
| **å…¥åŠ›è¦ä»¶** | URLå¿…é ˆ | ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®ã¿ã§OK | URLä¸è¦ã« |
| **ç”Ÿæˆç²¾åº¦** | ä¸­ï¼ˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼‰ | é«˜ï¼ˆå®Ÿéš›ã®è¦‹ãŸç›®ï¼‰ | +30% |
| **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Œå…¨æ€§** | 80%ï¼ˆå‹•çš„è¦ç´ æ¬ è½ï¼‰ | 100%ï¼ˆå…¨ã¦è¦‹ãˆã‚‹ï¼‰ | +20% |
| **ç”Ÿæˆæ™‚é–“** | 2-3åˆ†ï¼ˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°+ç”Ÿæˆï¼‰ | 1-2åˆ†ï¼ˆç”Ÿæˆã®ã¿ï¼‰ | -33% |
| **HTMLã‚µã‚¤ã‚º** | å¯å¤‰ | 350è¡Œä»¥ä¸Šï¼ˆäºˆæ¸¬ï¼‰ | - |

### 7.2 å®šæ€§çš„åŠ¹æœ

| åŠ¹æœ | èª¬æ˜ |
|-----|------|
| **æŸ”è»Ÿæ€§å‘ä¸Š** | URLãªã—ã§ã‚‚ç”Ÿæˆå¯èƒ½ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ |
| **ç²¾åº¦å‘ä¸Š** | å®Ÿéš›ã®è¦‹ãŸç›®ã‚’å®Œå…¨ã«å†ç¾ |
| **å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¯¾å¿œ** | JavaScriptã§ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚‚å†ç¾å¯èƒ½ |
| **ãƒ‡ãƒãƒƒã‚°å®¹æ˜“æ€§** | ç”»åƒã‚’è¦‹ã‚Œã°å•é¡ŒãŒæ˜ç¢º |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“** | ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã ã‘ |

---

## âœ… 8. å®Ÿè£…æ‰‹é †

### 8.1 ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤æ•´å‚™ï¼ˆ30åˆ†ï¼‰

**ã‚¿ã‚¹ã‚¯:**
1. `base_image_generator.py` ã®ä½œæˆ
   - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚³ãƒŸãƒƒãƒˆ `2add71d` ã‹ã‚‰å¾©å…ƒ
   - åœ§ç¸®ãƒ­ã‚¸ãƒƒã‚¯ã®æ”¹å–„ï¼ˆæ—¢ã«ãƒ†ã‚¹ãƒˆæ¸ˆã¿ï¼‰
   - Base64ã‚µã‚¤ã‚ºæ¤œè¨¼ã®è¿½åŠ 

2. `config.py` ã®ä¿®æ­£
   ```python
   # ç”»åƒç”Ÿæˆè¨­å®š
   IMAGE_GENERATOR: str = "claude"  # "claude" or "gemini"
   IMAGE_QUALITY: int = 85  # JPEGåœ§ç¸®å“è³ª
   MAX_IMAGE_BASE64_SIZE: int = 3_600_000  # 3.6MBï¼ˆ70%ãƒãƒ¼ã‚¸ãƒ³ï¼‰
   ```

3. `requirements.txt` ã®æ›´æ–°
   ```
   anthropic>=0.40.0
   pillow>=10.0.0
   scikit-learn>=1.3.0  # ãƒ‡ã‚¶ã‚¤ãƒ³æŠ½å‡ºç”¨ï¼ˆK-meansï¼‰
   ```

**æˆæœç‰©:**
- âœ… base_image_generator.pyï¼ˆ550è¡Œï¼‰
- âœ… config.pyï¼ˆIMAGE_GENERATORè¨­å®šï¼‰
- âœ… requirements.txtï¼ˆä¾å­˜é–¢ä¿‚ï¼‰

### 8.2 ãƒ•ã‚§ãƒ¼ã‚º2: Claudeå®Ÿè£…ï¼ˆ40åˆ†ï¼‰

**ã‚¿ã‚¹ã‚¯:**
1. `claude_image_generator.py` ã®ä½œæˆ
   - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ”¹å–„ï¼ˆãƒ’ãƒ¼ãƒ­ãƒ¼é«˜ã•ãƒ«ãƒ¼ãƒ«è¿½åŠ ï¼‰
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

2. `design_extractor.py` ã®ä½œæˆ
   - HTMLã‹ã‚‰ã®æŠ½å‡º
   - ç”»åƒã‹ã‚‰ã®æŠ½å‡ºï¼ˆK-meansï¼‰

3. `image_generator.py` ã®ä½œæˆ
   - ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³

**æˆæœç‰©:**
- âœ… claude_image_generator.pyï¼ˆ350è¡Œï¼‰
- âœ… design_extractor.pyï¼ˆ150è¡Œï¼‰
- âœ… image_generator.pyï¼ˆ50è¡Œï¼‰

### 8.3 ãƒ•ã‚§ãƒ¼ã‚º3: çµ±åˆï¼ˆ30åˆ†ï¼‰

**ã‚¿ã‚¹ã‚¯:**
1. `replicator_runner.py` ã®ä¿®æ­£
   - `_generate_from_image` ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
   - `_execute` ãƒ¡ã‚½ãƒƒãƒ‰ä¿®æ­£ï¼ˆãƒ¢ãƒ¼ãƒ‰åˆ¤å®šï¼‰

2. `models.py` ã®ä¿®æ­£ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - `ReplicationJob.screenshot_path` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 

**æˆæœç‰©:**
- âœ… replicator_runner.pyï¼ˆä¿®æ­£ï¼‰
- âœ… models.pyï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### 8.4 ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ†ã‚¹ãƒˆã¨æ¤œè¨¼ï¼ˆ30åˆ†ï¼‰

**ã‚¿ã‚¹ã‚¯:**
1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
3. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œï¼ˆTC-2: ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ç”»åƒï¼‰
5. çµæœç¢ºèª

**æˆæœç‰©:**
- âœ… ãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆ
- âœ… ç”Ÿæˆã•ã‚ŒãŸHTML/CSS/JS

### 8.5 ãƒ•ã‚§ãƒ¼ã‚º5: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆ10åˆ†ï¼‰

**ã‚¿ã‚¹ã‚¯:**
1. READMEæ›´æ–°ï¼ˆç”»åƒãƒ™ãƒ¼ã‚¹ç”Ÿæˆã®èª¬æ˜ï¼‰
2. è¨­å®šã‚¬ã‚¤ãƒ‰ï¼ˆç’°å¢ƒå¤‰æ•°ã€API ã‚­ãƒ¼ï¼‰

**æˆæœç‰©:**
- âœ… README.mdï¼ˆæ›´æ–°ï¼‰
- âœ… è¨­å®šã‚¬ã‚¤ãƒ‰

**åˆè¨ˆæ‰€è¦æ™‚é–“**: ç´„2æ™‚é–“20åˆ†

---

## ğŸ“ˆ 9. æˆåŠŸåŸºæº–

### 9.1 å¿…é ˆæ¡ä»¶ï¼ˆMust Haveï¼‰

- [ ] 973x5000px ç”»åƒãŒå˜ä¸€ç”»åƒã¨ã—ã¦é€ä¿¡ã•ã‚Œã‚‹
- [ ] Base64 ã‚µã‚¤ã‚ºãŒ 5MB ä»¥å†…ï¼ˆå®Ÿæ¸¬0.76MBï¼‰
- [ ] ç”Ÿæˆã•ã‚ŒãŸ HTML ã«å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå«ã¾ã‚Œã‚‹
  - [ ] ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³
  - [ ] èª¬æ˜æ–‡
  - [ ] å•†å“ç”»åƒ4æš
  - [ ] ãƒ•ãƒƒã‚¿ãƒ¼
- [ ] ã‚¨ãƒ©ãƒ¼ãªãç”Ÿæˆå®Œäº†
- [ ] å¾Œæ–¹äº’æ›æ€§ï¼ˆURLå…¥åŠ›ã§ã‚‚å‹•ä½œï¼‰

### 9.2 æ¨å¥¨æ¡ä»¶ï¼ˆShould Haveï¼‰

- [ ] HTMLè¡Œæ•°ãŒ 350è¡Œä»¥ä¸Š
- [ ] ç”Ÿæˆæ™‚é–“ãŒ 3åˆ†ä»¥å†…
- [ ] ãƒ’ãƒ¼ãƒ­ãƒ¼é«˜ã•ãƒ«ãƒ¼ãƒ«ï¼ˆ80vh / 100vhï¼‰ãŒé©ç”¨ã•ã‚Œã‚‹
- [ ] ãƒ‡ã‚¶ã‚¤ãƒ³è¦ç´ ãŒæ­£ç¢ºã«æŠ½å‡ºã•ã‚Œã‚‹

### 9.3 ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ¡ä»¶ï¼ˆNice to Haveï¼‰

- [ ] å‹•ç”»å…¥åŠ›å¯¾å¿œï¼ˆJavaScriptç”Ÿæˆï¼‰
- [ ] Gemini API å¯¾å¿œ
- [ ] ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«å¯¾å¿œï¼ˆç”»åƒ+å‹•ç”»+HTMLï¼‰

---

## ğŸ” 10. æŠ€è¡“çš„è©³ç´°

### 10.1 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆå®Ÿè£…å¾Œï¼‰

```
backend/app/services/replicator/
â”œâ”€â”€ __init__.py                  # SiteScraper, ClaudeGenerator, Verifier, ImageGeneratorFactory
â”œâ”€â”€ site_scraper.py              # æ—¢å­˜ï¼ˆURLãƒ™ãƒ¼ã‚¹ï¼‰
â”œâ”€â”€ claude_generator.py          # æ—¢å­˜ï¼ˆClaude CLIï¼‰
â”œâ”€â”€ verifier.py                  # æ—¢å­˜
â”œâ”€â”€ image_comparator.py          # æ—¢å­˜
â”œâ”€â”€ base_image_generator.py      # æ–°è¦ï¼ˆåŸºåº•ã‚¯ãƒ©ã‚¹ï¼‰
â”œâ”€â”€ claude_image_generator.py    # æ–°è¦ï¼ˆVision APIï¼‰
â”œâ”€â”€ gemini_image_generator.py    # æ–°è¦ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”œâ”€â”€ image_generator.py           # æ–°è¦ï¼ˆãƒ•ã‚¡ã‚¯ãƒˆãƒªï¼‰
â””â”€â”€ design_extractor.py          # æ–°è¦ï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³æŠ½å‡ºï¼‰
```

### 10.2 ä¾å­˜é–¢ä¿‚

```python
# requirements.txt
anthropic>=0.40.0          # Claude Vision API
pillow>=10.0.0             # ç”»åƒå‡¦ç†
scikit-learn>=1.3.0        # K-meansï¼ˆè‰²æŠ½å‡ºï¼‰
numpy>=1.24.0              # ç”»åƒå‡¦ç†
aiohttp>=3.9.0             # éåŒæœŸHTTPï¼ˆæ—¢å­˜ï¼‰
beautifulsoup4>=4.12.0     # HTMLè§£æï¼ˆæ—¢å­˜ï¼‰
```

### 10.3 ç’°å¢ƒå¤‰æ•°

```bash
# .env
ANTHROPIC_API_KEY=sk-ant-...           # Claude API ã‚­ãƒ¼ï¼ˆå¿…é ˆï¼‰
IMAGE_GENERATOR=claude                  # "claude" or "gemini"
IMAGE_QUALITY=85                        # JPEGåœ§ç¸®å“è³ªï¼ˆ50-95ï¼‰
MAX_IMAGE_BASE64_SIZE=3600000          # Base64æœ€å¤§ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
GENERATION_TIMEOUT=900                  # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰
```

### 10.4 ãƒ­ã‚°å‡ºåŠ›ä¾‹

```
2026-01-27 12:00:00 INFO Using image-based generation: /Volumes/DB/ä¿å­˜/FireShot*.png
2026-01-27 12:00:01 INFO Image size: 973x5000 (aspect ratio: 5.14)
2026-01-27 12:00:02 INFO JPEG size: binary=0.57MB, base64=0.76MB (OK)
2026-01-27 12:00:02 INFO Calling Claude Vision API...
2026-01-27 12:01:45 INFO Claude API response received (length=25432)
2026-01-27 12:01:46 INFO Generated code successfully: HTML=12543 chars, CSS=8921 chars, JS=3968 chars
```

---

## ğŸ“… 11. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| ãƒ•ã‚§ãƒ¼ã‚º | ä½œæ¥­å†…å®¹ | æ‰€è¦æ™‚é–“ | æ‹…å½“ |
|---------|---------|---------|------|
| **æº–å‚™** | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€ç’°å¢ƒç¢ºèª | 10åˆ† | serena-expert |
| **ãƒ•ã‚§ãƒ¼ã‚º1** | åŸºç›¤æ•´å‚™ï¼ˆbase, config, requirementsï¼‰ | 30åˆ† | serena-expert |
| **ãƒ•ã‚§ãƒ¼ã‚º2** | Claudeå®Ÿè£…ï¼ˆclaude, design, factoryï¼‰ | 40åˆ† | serena-expert |
| **ãƒ•ã‚§ãƒ¼ã‚º3** | çµ±åˆï¼ˆreplicator_runner, modelsï¼‰ | 30åˆ† | serena-expert |
| **ãƒ•ã‚§ãƒ¼ã‚º4** | ãƒ†ã‚¹ãƒˆã¨æ¤œè¨¼ | 30åˆ† | æ‰‹å‹•/è‡ªå‹• |
| **ãƒ•ã‚§ãƒ¼ã‚º5** | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | 10åˆ† | serena-expert |
| **åˆè¨ˆ** | | **2æ™‚é–“30åˆ†** | |

---

## ğŸ¯ 12. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 12.1 æ‰¿èªå¾…ã¡
- [ ] ã“ã®è¨ˆç”»æ›¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èª

### 12.2 å®Ÿè£…é–‹å§‹
æ‰¿èªå¾Œã€ä»¥ä¸‹ã®é †åºã§é€²ã‚ã¾ã™ï¼š
1. âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚³ãƒŸãƒƒãƒˆã‹ã‚‰å‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
2. âœ… ãƒ•ã‚§ãƒ¼ã‚º1ã‹ã‚‰é †æ¬¡å®Ÿè£…
3. âœ… å„ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†å¾Œã«é€²æ—å ±å‘Š
4. âœ… ãƒ•ã‚§ãƒ¼ã‚º4ã§ãƒ†ã‚¹ãƒˆçµæœã‚’å ±å‘Š
5. âœ… å•é¡ŒãŒã‚ã‚Œã°ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ãªã‘ã‚Œã°ã‚³ãƒŸãƒƒãƒˆ

---

## âœï¸ ç½²å

**è¨ˆç”»ä½œæˆè€…**: Claude Sonnet 4.5
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0ï¼ˆæ”¹å–„ç‰ˆï¼‰
**ä½œæˆæ—¥**: 2026-01-27
**ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªå¾…ã¡

---

**ã“ã®è¨ˆç”»ã§å®Ÿè£…ã‚’é–‹å§‹ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ**

æ‰¿èªã„ãŸã ã‘ã‚Œã°ã€serena-expertã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å„ãƒ•ã‚§ãƒ¼ã‚ºã‚’å§”è¨—ã—ã¦ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè£…ã‚’é€²ã‚ã¾ã™ã€‚
